<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù…Ø³Ø§Ø¨Ù‚Ø© - Ù†Ø¹ÙˆÙ…Ø© Ù†Ø¹ÙˆÙ…ØªÙƒ</title>
<style>
:root{
  --bg:#fff0f8; --card:#ffffff; --accent:#ff6fa3; --accent-2:#ffd9ec; --text:#2b2b2b;
}
*{box-sizing:border-box;font-family:"Tajawal",sans-serif}
body{background:linear-gradient(180deg,var(--bg),#fff);min-height:100vh;margin:0;padding:24px;display:flex;align-items:center;justify-content:center}
.container{width:100%;max-width:820px}
.card{background:var(--card);border-radius:18px;padding:22px;box-shadow:0 8px 30px rgba(0,0,0,0.07);animation:fadeIn .7s ease}
@keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
h1{margin:6px 0 12px;color:var(--accent);font-size:22px}
p.lead{margin:0 0 14px;color:var(--text);opacity:.9}
label{display:block;margin:10px 0 6px;font-weight:600;color:var(--text)}
input[type=text]{width:100%;padding:12px;border-radius:10px;border:1px solid #eee;background:var(--accent-2);transition:all .2s}
input[type=text]:focus{border-color:var(--accent);background:#fff;outline:none}
button{background:var(--accent);color:#fff;padding:10px 14px;border:none;border-radius:10px;font-weight:700;cursor:pointer;transition:transform .15s}
button:hover{transform:scale(1.04)}
.muted{color:#666;font-size:13px}
.hidden{display:none}
.question{padding:12px;border-radius:12px;border:1px dashed #f3cde0;margin-bottom:10px}
.options{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.opt{padding:10px;border-radius:10px;background:#fff;cursor:pointer;border:1px solid #f2f2f2}
.opt:hover{background:var(--accent-2)}
.opt input{margin-left:8px}
.timer{font-weight:800;color:var(--accent)}
/* Welcome message */
#welcomeMessage{background:var(--accent-2);padding:14px;border-radius:12px;margin-top:15px;color:var(--accent);font-weight:600;text-align:center;display:none;animation:slideDown .7s ease}
@keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}

/* Violation modal */
#violationCard{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#ff6fa3,#ffd9ec);color:#fff;text-align:center;padding:36px 28px;border-radius:22px;box-shadow:0 14px 60px rgba(0,0,0,.3);font-size:18px;width:92%;max-width:520px;z-index:9999}
#violationCard h1,#violationCard p{margin-bottom:18px}
#violationClose{background:#fff;color:#ff6fa3;border:none;padding:10px 18px;border-radius:12px;cursor:pointer;font-weight:700}
#violationClose:hover{transform:scale(1.05);background:#ffe6f0}

/* Result card (beautiful) */
#resultCard{background:linear-gradient(135deg,#ff6fa3,#ffd9ec);color:#fff;text-align:center;box-shadow:0 12px 60px rgba(0,0,0,.28);border-radius:20px;padding:30px;animation:slideDown .7s ease}
#resultCard h1{font-size:26px;margin-bottom:12px}
#resultCard .result{font-size:22px;font-weight:700;margin-bottom:16px}
.result-actions{display:flex;gap:12px;margin-top:10px;justify-content:center}
.result-actions button{background:#fff;color:#ff6fa3;padding:10px 18px;border:none;border-radius:12px;font-weight:700;cursor:pointer;transition:transform .15s}
.result-actions button:hover{transform:scale(1.06);background:#ffe6f0;color:#ff6fa3}

/* small screens */
@media (max-width:420px){
  #resultCard .result{font-size:18px}
  h1{font-size:20px}
}
</style>
</head>
<body>
<div class="container">

  <!-- Welcome card -->
  <div class="card" id="welcomeCard">
    <h1>ğŸŒ¸ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒÙ ÙÙŠ Ø¹Ø§Ø¦Ù„Ø© "Ù†Ø¹ÙˆÙ…Ø© Ù†Ø¹ÙˆÙ…ØªÙƒ" ğŸŒ¸</h1>
    <p class="lead">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„ØªØ¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±. Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‡Ùˆ <strong>Ù†Ø¹ÙˆÙ…Ø©4</strong>.</p>
    <label>Ø§Ù„Ø§Ø³Ù…</label>
    <input id="nameInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
    <label>Ø§Ù„Ø±Ù…Ø²</label>
    <input id="codeInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ù…Ø² Ù‡Ù†Ø§">
    <div style="margin-top:14px;display:flex;gap:10px;align-items:center">
      <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
      <div class="muted" style="font-size:13px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø±Ù…Ø² Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø±ØªÙŠÙ†.</div>
    </div>
    <div id="welcomeMessage"></div>
  </div>

  <!-- Quiz card -->
  <div class="card hidden" id="quizCard">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <strong id="playerName"></strong>
        <div class="muted">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: <span id="playerCode"></span></div>
      </div>
      <div class="timer" id="timer">05:00</div>
    </div>
    <hr>
    <div id="questionsArea"></div>
    <div style="display:flex;justify-content:center;margin-top:12px">
      <button id="finishBtn">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
    </div>
  </div>

  <!-- Result card -->
  <div id="resultCard" class="hidden card">
    <h1>âœ¨ Ù†ØªÙŠØ¬ØªÙƒ âœ¨</h1>
    <p class="result" id="resultSummary"></p>
    <div class="result-actions">
      <button id="copyBtn">Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
      <button id="closeBtn">Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø¹Ø§Ø¦Ù„ØªÙƒ</button>
    </div>
  </div>

  <!-- Violation -->
  <div id="violationCard" class="hidden" role="alertdialog" aria-modal="true">
    <h1>ğŸš« Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ğŸš«</h1>
    <p id="violationMessage">ØªÙ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ù…Ø®Ø§Ù„ÙØ© â€” Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©.</p>
    <div style="display:flex;gap:10px;justify-content:center">
      <button id="violationClose">Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø¹Ø§Ø¦Ù„ØªÙƒ</button>
    </div>
  </div>

</div>

<script>
/* ==== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ==== */
const QUESTIONS = [
  // 3 Ø£Ø­Ø§Ø¯ÙŠØ«
  {q:'Ù…Ù† Ù‚Ø§Ù„: "Ù„Ø§ ÙŠØ¤Ù…Ù† Ø£Ø­Ø¯ÙƒÙ… Ø­ØªÙ‰ ÙŠØ­Ø¨ Ù„Ø£Ø®ÙŠÙ‡ Ù…Ø§ ÙŠØ­Ø¨ Ù„Ù†ÙØ³Ù‡"ØŸ',opts:['Ø§Ù„Ù†Ø¨ÙŠ ï·º','Ø£Ø¨Ùˆ Ø¨ÙƒØ±','Ø¹Ù…Ø±','Ø¹Ø«Ù…Ø§Ù†'],a:0,type:'choice'},
  {q:'Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø°ÙŠ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ "Ù…Ù† Ù„Ø§ ÙŠØ´ÙƒØ± Ø§Ù„Ù†Ø§Ø³ Ù„Ø§ ÙŠØ´ÙƒØ± Ø§Ù„Ù„Ù‡"ØŸ',opts:['Ø­Ø¯ÙŠØ« Ù†Ø¨ÙˆÙŠ','Ø­Ø¯ÙŠØ« ØµØ­Ø§Ø¨ÙŠ','Ø­Ø¯ÙŠØ« ØªØ§Ø¨Ø¹ÙŠ','Ø­Ø¯ÙŠØ« Ø¶Ø¹ÙŠÙ'],a:0,type:'choice'},
  {q:'Ø£ÙŠ Ø§Ù„Ø­Ø¯ÙŠØ« Ø¹Ù† ÙØ¶Ù„ Ø§Ù„ØµØ¯Ù‚Ø©ØŸ',opts:['Ù…Ù† ØªØµØ¯Ù‚...','Ù…Ù† ØµØ§Ù… Ø±Ù…Ø¶Ø§Ù†...','Ù…Ù† Ù‚Ø±Ø£ Ø§Ù„Ù‚Ø±Ø¢Ù†...','Ù…Ù† Ø³Ù…Ø¹ Ø§Ù„Ø¹Ù„Ù…...'],a:0,type:'choice'},

  // 3 Ø¹Ù„Ù… Ù†ÙØ³
  {q:'Ù…Ø§ Ù‡ÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„ØªÙŠ ØªÙ‚ÙˆÙ„ "Ù†Ø­Ù† Ù†Ù…ÙŠÙ„ Ø¥Ù„Ù‰ ØªØ°ÙƒØ± Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„Ø³Ù‡Ù„Ø©"ØŸ',opts:['Ø§Ù„ØªØ­ÙŠØ² Ø§Ù„Ù…Ø¹Ø±ÙÙŠ','Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠØ©','Ø§Ù„Ø§Ù†Ø·Ø¨Ø§Ø¹ Ø§Ù„Ø£ÙˆÙ„','Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø°Ù‡Ù†ÙŠ'],a:1,type:'choice'},
  {q:'Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´Ø¹ÙˆØ± Ø§Ù„Ù†Ø§ØªØ¬ Ø¹Ù† Ù…Ù‚Ø§Ø±Ù†Ø© Ù†ÙØ³Ùƒ Ø¨Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†ØŸ',opts:['Ø§Ù„ØºÙŠØ±Ø©','Ø§Ù„Ø±Ø¶Ø§','Ø§Ù„Ø­Ø¨','Ø§Ù„Ø®ÙˆÙ'],a:0,type:'choice'},
  {q:'Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±Ù‚ ØªØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªÙˆØªØ± Ø§Ù„Ù†ÙØ³ÙŠØŸ',opts:['Ø§Ù„ØªÙ†ÙØ³ Ø§Ù„Ø¹Ù…ÙŠÙ‚','Ø§Ù„Ø¬Ù„ÙˆØ³ Ø¨Ø¯ÙˆÙ† Ù‡Ø¯Ù','ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±','Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø³Ù„Ø¨ÙŠ'],a:0,type:'choice'},

  // 3 Ø¹Ù† Ø§Ù„Ø¨Ø´Ø±Ø©/Ø§Ù„Ø¹Ù†Ø§ÙŠØ©
  {q:'Ù…Ø§ Ù‡ÙŠ Ø£Ù‡Ù… Ø®Ø·ÙˆØ© Ù„Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ØŸ',opts:['ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨Ø´Ø±Ø©','ÙˆØ¶Ø¹ Ø§Ù„Ù…ÙƒÙŠØ§Ø¬','Ø¹Ø¯Ù… Ø§Ù„Ù†ÙˆÙ…','Ø§Ù„Ø­Ù…ÙŠØ© ÙÙ‚Ø·'],a:0,type:'choice'},
  {q:'Ø£ÙŠ Ø¹Ù†ØµØ± ÙŠØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø¥Ø´Ø±Ø§Ù‚ Ø§Ù„Ø¨Ø´Ø±Ø©ØŸ',opts:['ÙÙŠØªØ§Ù…ÙŠÙ† C','Ø§Ù„Ø¯Ù‡ÙˆÙ† Ø§Ù„Ù…Ø´Ø¨Ø¹Ø©','Ø§Ù„Ø³ÙƒØ±ÙŠØ§Øª','Ø§Ù„ÙƒØ§ÙÙŠÙŠÙ†'],a:0,type:'choice'},
  {q:'Ù…Ø§ Ø£ÙØ¶Ù„ ÙˆÙ‚Øª Ù„ÙˆØ¶Ø¹ ÙˆØ§Ù‚ÙŠ Ø§Ù„Ø´Ù…Ø³ØŸ',opts:['Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ø±Ø¶ Ù„Ù„Ø´Ù…Ø³','Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø±Ø¶ Ù„Ù„Ø´Ù…Ø³','ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ…','Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ­Ù…Ø§Ù… Ù…Ø¨Ø§Ø´Ø±Ø©'],a:0,type:'choice'},

  // Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù†ØµÙŠ Ø§Ù„Ø£Ø®ÙŠØ± â€” ÙŠØªØ·Ù„Ø¨ ÙƒØªØ§Ø¨Ø© 5 Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ÙØµÙˆÙ„Ø© Ø¨Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© "ØŒ"
  {q:'Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠØ¬Ø¹Ù„ ÙˆØ¬Ù‡Ùƒ ÙŠØ´Ø¹ Ø¨Ø§Ù„Ù†ÙˆØ±ØŸ (Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ÙØµÙˆÙ„Ø© Ø¨Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© "ØŒ")',
   answer:['Ù†Ù‚Ø§Ø¡ Ø§Ù„Ù‚Ù„Ø¨','Ø­Ø¨ Ø§Ù„Ù„Ù‡','Ø°ÙƒØ± Ø§Ù„Ù„Ù‡','Ø­Ø¨ Ù…Ø®Ù„ÙˆÙ‚Ø§ØªÙ‡','Ø§Ù„ØµÙ„Ø§Ø©'],type:'text'}
];

/* ==== Ø¹Ù†Ø§ØµØ± DOM ==== */
const welcomeCard = document.getElementById('welcomeCard');
const quizCard = document.getElementById('quizCard');
const resultCard = document.getElementById('resultCard');
const nameInput = document.getElementById('nameInput');
const codeInput = document.getElementById('codeInput');
const startBtn = document.getElementById('startBtn');
const questionsArea = document.getElementById('questionsArea');
const finishBtn = document.getElementById('finishBtn');
const resultSummary = document.getElementById('resultSummary');
const playerName = document.getElementById('playerName');
const playerCode = document.getElementById('playerCode');
const copyBtn = document.getElementById('copyBtn');
const closeBtn = document.getElementById('closeBtn');
const welcomeMessage = document.getElementById('welcomeMessage');
const violationCard = document.getElementById('violationCard');
const violationMessage = document.getElementById('violationMessage');
const violationClose = document.getElementById('violationClose');
const timerEl = document.getElementById('timer');

/* ==== Ø­Ø§Ù„Ø© ÙˆÙˆÙ‚Øª ==== */
let timerInterval = null;
let timeLeft = 300; // 5 Ø¯Ù‚Ø§Ø¦Ù‚

/* ==== localStorage helpers ==== */
function loadAttempts(){
  try{ return JSON.parse(localStorage.getItem('nn_attempts')||'{}'); }
  catch(e){ return {}; }
}
function saveAttempt(code,data){
  const a = loadAttempts();
  a[code] = data;
  localStorage.setItem('nn_attempts', JSON.stringify(a));
}
function hasAttempt(code){
  const a = loadAttempts();
  return a.hasOwnProperty(code);
}
function saveNameCode(name,code){
  localStorage.setItem('nn_name', name);
  localStorage.setItem('nn_code', code);
}

/* ==== Ù…Ù†Ø¹ PrintScreen (Ù…Ø­Ø¯ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª) ==== */
document.addEventListener('keydown', function(e){
  if(e.key === "PrintScreen"){ e.preventDefault(); alert("Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ø®Ø° Ø³ÙƒØ±ÙŠÙ† Ù„Ù„Ø¹Ø¨Ø©!"); }
});

/* ==== Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø®Ø§Ù„ÙØ© ÙˆØ¥Ù‚ÙØ§Ù„ ÙƒÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ==== */
function showViolation(name = '', msg = "Ù†Ø¹ØªØ°Ø±ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¹Ø¨Ø© Ù„Ø£Ù†Ùƒ Ø®Ø§Ù„ÙØª Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù„Ø¹Ø¨Ø© âŒ"){
  violationMessage.textContent = `${msg}${ name ? ' â€” ' + name : '' }`;
  violationCard.classList.remove('hidden');
  welcomeCard.classList.add('hidden');
  quizCard.classList.add('hidden');
  resultCard.classList.add('hidden');
  // Ø¯ÙØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¹Ø¯Ù… Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ù‡Ù†Ø§ â€” Ù„ÙƒÙ† Ù„Ø§ Ù†Ø¹ÙŠØ¯ ØªÙˆØ¬ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø³ÙˆÙ‰ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
}

/* ==== Ø¨Ø¯Ø¡ ===== */
startBtn.onclick = () => {
  const name = nameInput.value.trim();
  const code = codeInput.value.trim();
  if(!name){ alert('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù….'); return; }
  if(!code){ alert('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø².'); return; }
  // Ù…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„Ø±Ù…Ø² Ù…Ø±ØªÙŠÙ†: Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ => Ù…Ø®Ø§Ù„ÙØ©
  if(hasAttempt(code)){
    showViolation(name,"ØªÙ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ Ø¨Ø±Ù…Ø² Ù…Ø³ØªØ®Ø¯Ù… Ø³Ø§Ø¨Ù‚Ù‹Ø§ âŒ");
    return;
  }
  // Ø³Ø¬Ù„ Ø§Ù„Ø±Ù…Ø² ÙÙˆØ±Ø§Ù‹ ÙƒÙ€ inprogress Ù„Ù…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ù† Ø¬Ù‡Ø© Ø£Ø®Ø±Ù‰
  saveAttempt(code, { name, status: 'inprogress', date: new Date().toISOString() });
  saveNameCode(name, code);

  welcomeMessage.style.display = "block";
  welcomeMessage.textContent = `ğŸŒ· Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ ${name}! Ø³ÙŠØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¢Ù† â€” ØªØ°ÙƒØ±ÙŠ: Ù„Ø§ ÙŠÙØ³Ù…Ø­ Ø¨Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.`;
  setTimeout(()=> beginQuiz(name,code), 1200);
};

/* ==== Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ==== */
function beginQuiz(name, code){
  // Ø¯ÙØ¹ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ù…Ù†Ø¹ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
  try{ history.pushState({quizStarted: true}, '', location.href); } catch(e){}
  welcomeCard.classList.add('hidden');
  quizCard.classList.remove('hidden');
  playerName.textContent = name;
  playerCode.textContent = code;
  renderQuestions();
  // Ø¶Ø¨Ø· Ù…Ø¤Ù‚Øª
  timeLeft = 300;
  timerEl && (timerEl.textContent = '05:00');
  timerInterval && clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    timeLeft--;
    const min = String(Math.floor(timeLeft/60)).padStart(2,'0');
    const sec = String(timeLeft%60).padStart(2,'0');
    timerEl && (timerEl.textContent = `${min}:${sec}`);
    if(timeLeft <= 0){ finishTest(name, code); }
  }, 1000);
}

/* ==== Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ==== */
function renderQuestions(){
  questionsArea.innerHTML = '';
  QUESTIONS.forEach((q,i)=>{
    const div = document.createElement('div');
    div.className = 'question';
    div.innerHTML = `<div><strong>Ø³Ø¤Ø§Ù„ ${i+1}:</strong> ${q.q}</div>`;
    if(q.type === 'choice'){
      const opts = document.createElement('div'); opts.className = 'options';
      q.opts.forEach((o,j)=>{
        const lbl = document.createElement('label'); lbl.className = 'opt';
        lbl.innerHTML = `<input type="radio" name="q${i}" value="${j}"> ${o}`;
        opts.appendChild(lbl);
      });
      div.appendChild(opts);
    } else if(q.type === 'text'){
      const input = document.createElement('input'); input.type = 'text'; input.name = 'q'+i; input.placeholder = 'Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§';
      div.appendChild(input);
      // ØªÙˆØ¶ÙŠØ­ Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ø®ÙŠØ±
      if(i === QUESTIONS.length - 1){
        const hint = document.createElement('div');
        hint.className = 'muted';
        hint.style.marginTop = '8px';
        hint.textContent = 'Ù…Ù‡Ù…: Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ù…Ø³Ø© Ù…ÙØµÙˆÙ„Ø© Ø¨Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© "ØŒ" Ø¨Ø§Ù„Ø¶Ø¨Ø· â€” Ù…Ø«Ø§Ù„: Ù†Ù‚Ø§Ø¡ Ø§Ù„Ù‚Ù„Ø¨ØŒ Ø­Ø¨ Ø§Ù„Ù„Ù‡ØŒ Ø°ÙƒØ± Ø§Ù„Ù„Ù‡ØŒ Ø­Ø¨ Ù…Ø®Ù„ÙˆÙ‚Ø§ØªÙ‡ØŒ Ø§Ù„ØµÙ„Ø§Ø©';
        div.appendChild(hint);
      }
    }
    questionsArea.appendChild(div);
  });
}

/* ==== Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· ==== */
finishBtn.onclick = ()=> finishTest(playerName.textContent, playerCode.textContent);

function finishTest(name, code){
  clearInterval(timerInterval);
  let score = 0;
  QUESTIONS.forEach((q,i)=>{
    if(q.type === 'choice'){
      const sel = [...document.getElementsByName('q'+i)].find(e=>e.checked);
      if(sel && parseInt(sel.value) === q.a) score += 10;
    } else if(q.type === 'text'){
      const input = document.getElementsByName('q'+i)[0];
      const val = (input && input.value || '').trim();
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØµØ§Ø±Ù…: ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© "ØŒ" Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ±ØŒ ÙˆÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø®Ù…Ø³Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© (Ø£ÙŠ ØªØ±ØªÙŠØ¨ Ù…Ù‚Ø¨ÙˆÙ„)
      const required = q.answer; // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
      // ØªÙ‚Ø³ÙŠÙ… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© â€” Ù‡Ø°Ø§ ÙŠØ¶Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙÙˆØ§ØµÙ„
      const parts = val.split('ØŒ').map(s=>s.trim()).filter(Boolean);
      // Ø´Ø±Ø· Ù‚Ø¨ÙˆÙ„: Ø¨Ø§Ù„Ø¶Ø¨Ø· 5 Ø£Ø¬Ø²Ø§Ø¡ Ù…ÙØµÙˆÙ„Ø© Ø¨Ù€ "ØŒ" ÙˆÙŠØ­ØªÙˆÙŠ ÙƒÙ„ Ø¬Ø²Ø¡ Ø¹Ù„Ù‰ Ø£Ø­Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Øµ)
      let allPresent = false;
      if(parts.length === required.length){
        allPresent = required.every(req => parts.some(p => p === req));
      }
      if(allPresent) score += 10;
      // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ù† Ù„Ù… ÙŠÙƒÙ† Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù…Ø·Ø§Ø¨Ù‚Ù‹Ø§ (Ù…Ø«Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙÙˆØ§ØµÙ„ Ø£Ùˆ Ø¹Ø¯Ø¯ Ø£Ø¬Ø²Ø§Ø¡ Ù…Ø®ØªÙ„Ù) => Ù„Ø§ ØªÙÙ…Ù†Ø­ Ø§Ù„Ù†Ù‚Ø§Ø·
    }
  });

  // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ completed
  saveAttempt(code, { name, score, status: 'completed', date: new Date().toISOString() });

  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø´ÙƒÙ„ Ø¬Ù…ÙŠÙ„
  quizCard.classList.add('hidden');
  resultCard.classList.remove('hidden');
  resultSummary.innerHTML = `<strong>${name}</strong><br>Ø­ØµÙ„Øª Ø¹Ù„Ù‰ <strong>${score} Ù…Ù† ${QUESTIONS.length*10}</strong> Ù†Ù‚Ø·Ø©.<br>ğŸ’– Ù…Ø¨Ø§Ø±Ùƒ Ù„Ùƒ Ø¹Ù„Ù‰ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!`;

  // Ù„Ø§Ø­Ø¸: Ø¨Ù…Ø¬Ø±Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ØŒ ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ø±Ù…Ø² Ù…Ø³ØªØ®Ø¯Ù…Ø§Ù‹ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ (Ø®Ø§ØµØ© Ù„Ø£Ù†Ù†Ø§ Ø­Ø¬Ø²Ù†Ø§Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©)
}

/* ==== Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø© ==== */
copyBtn.onclick = async () => {
  try{
    await navigator.clipboard.writeText(resultSummary.textContent);
    alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©!');
  }catch(e){
    alert('Ø§Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§.');
  }
};

/* ==== Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ ==== */
closeBtn.onclick = () => { window.location.href = 'https://www.facebook.com/profile.php?id=61581366775114'; };
violationClose.onclick = () => { window.location.href = 'https://www.facebook.com/profile.php?id=61581366775114'; };

/* ==== Ù…Ù†Ø¹ Ø§Ù„ØºØ´: Ù‚Ø¨Ù„ Ø¥ØºÙ„Ø§Ù‚/ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© ==== */
// Ù‚Ø¨Ù„unload: Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ÙˆÙ†Ø¸Ù‡Ø± Ù…Ø®Ø§Ù„ÙØ© (Ø³ØªØ¸Ù‡Ø± ÙÙŠ Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…ØªØµÙØ­Ø§Øª).
window.addEventListener('beforeunload', function(e){
  // Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø®Ø§Ù„ÙØ© Ø¹Ù†Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
  const storedName = localStorage.getItem('nn_name') || '';
  showViolation(storedName, "ØªÙ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ù…Ø­Ø§ÙˆÙ„Ø© ØºØ´ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© âŒ");
  // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© (Ù…Ø·Ù„ÙˆØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØµÙØ­) â€” Ù‡Ø°Ø§ ÙŠÙ…Ù†Ø¹ Ø¹Ø§Ø¯Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„.
  e.preventDefault();
  e.returnValue = '';
  return '';
});

// Ù…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹: Ù†Ø¶ÙŠÙ Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆÙ†ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ popstate
window.addEventListener('popstate', function(event){
  const storedName = localStorage.getItem('nn_name') || '';
  showViolation(storedName, "ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù„Ù â€” ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© âŒ");
});

// Ø£ÙŠØ¶Ø§Ù‹ Ù†Ù…Ù†Ø¹ history.back Ø¹Ø¨Ø± Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© (Ù„ÙˆØ¶Ø¹ Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©)
function blockBackNavigation(){
  try{ history.pushState(null, document.title, location.href); }catch(e){}
}
blockBackNavigation();

/* ==== Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©: Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙƒØ±Ø± Ø£Ùˆ Ø§ÙƒØªØ´Ø§Ù Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø© ==== */
window.addEventListener('load', function(){
  const storedName = localStorage.getItem('nn_name');
  const storedCode = localStorage.getItem('nn_code');
  const attempts = loadAttempts();
  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ ÙƒÙ€ completed Ø£Ùˆ inprogress => Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø®Ø§Ù„ÙØ©
  if(storedCode && attempts[storedCode]){
    // Ø¥Ø°Ø§ Ø§Ù„Ø­Ø§Ù„Ø© inprogress Ø£Ùˆ completed => Ù…Ù†Ø¹
    showViolation(storedName, "ØªÙ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ Ù…ÙƒØ±Ø± Ø£Ùˆ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø© Ù…Ù† Ù‚Ø¨Ù„ âŒ");
  }
});

/* ==== Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Enter) ==== */
nameInput.addEventListener('keypress', e => { if(e.key === "Enter") startBtn.click(); });
codeInput.addEventListener('keypress', e => { if(e.key === "Enter") startBtn.click(); });

/* ==== Ù…Ù„Ø§Ø­Ø¸Ø© ØªÙ‚Ù†ÙŠØ© Ù…Ù‡Ù…Ø© Ù„Ù„Ù…Ø·ÙˆØ±: ==== */
/*
  - ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ ÙÙˆØ± Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±" ÙÙŠ localStorage ÙƒÙ€ inprogress
    Ø­ØªÙ‰ Ù„Ø§ ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø±ØªÙŠÙ† (Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ…Ù„ Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±).
  - Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù…Ø² Ù…Ø§ Ø·Ø±ÙŠÙ‚ÙŠØ§Ù‹: ÙŠØ¬Ø¨ Ø­Ø°Ù Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† localStorage 'nn_attempts'
    Ø£Ùˆ ØªØ­Ø±ÙŠØ±Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹ â€” ÙˆÙ‡Ø°Ø§ ØªÙˆÙ‚Ø¹ Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù….
  - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ø®ÙŠØ± ØµØ§Ø±Ù…: ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø®Ù…Ø³Ø© Ù…ÙØµÙˆÙ„Ø© Ø¨Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© "ØŒ"
    Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø£ÙŠÙ‹Ø§ ÙƒØ§Ù†ØŒ ÙˆÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙƒÙ„ Ù‚Ø·Ø¹Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ø­Ø±ÙÙŠÙ‹Ø§ Ù„Ø£Ø­Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.
*/
</script>
</body>
</html>
