<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>مسابقة - نعومة نعومتك</title>
<style>
:root{
  --bg:#fff0f8; --card:#ffffff; --accent:#ff6fa3; --accent-2:#ffd9ec; --text:#2b2b2b;
}
*{box-sizing:border-box;font-family:"Tajawal",sans-serif}
body{background:linear-gradient(180deg,var(--bg),#fff);min-height:100vh;margin:0;padding:24px;display:flex;align-items:center;justify-content:center}
.container{width:100%;max-width:820px}
.card{background:var(--card);border-radius:18px;padding:22px;box-shadow:0 8px 30px rgba(0,0,0,0.07);animation:fadeIn .7s ease}
@keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
h1{margin:6px 0 12px;color:var(--accent);font-size:22px}
p.lead{margin:0 0 14px;color:var(--text);opacity:.9}
label{display:block;margin:10px 0 6px;font-weight:600;color:var(--text)}
input[type=text]{width:100%;padding:12px;border-radius:10px;border:1px solid #eee;background:var(--accent-2);transition:all .2s}
input[type=text]:focus{border-color:var(--accent);background:#fff;outline:none}
button{background:var(--accent);color:#fff;padding:10px 14px;border:none;border-radius:10px;font-weight:700;cursor:pointer;transition:transform .15s}
button:hover{transform:scale(1.04)}
.muted{color:#666;font-size:13px}
.hidden{display:none}
.question{padding:12px;border-radius:12px;border:1px dashed #f3cde0;margin-bottom:10px}
.options{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.opt{padding:10px;border-radius:10px;background:#fff;cursor:pointer;border:1px solid #f2f2f2}
.opt:hover{background:var(--accent-2)}
.opt input{margin-left:8px}
.timer{font-weight:800;color:var(--accent)}
/* Welcome message */
#welcomeMessage{background:var(--accent-2);padding:14px;border-radius:12px;margin-top:15px;color:var(--accent);font-weight:600;text-align:center;display:none;animation:slideDown .7s ease}
@keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}

/* Violation modal */
#violationCard{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#ff6fa3,#ffd9ec);color:#fff;text-align:center;padding:36px 28px;border-radius:22px;box-shadow:0 14px 60px rgba(0,0,0,.3);font-size:18px;width:92%;max-width:520px;z-index:9999}
#violationCard h1,#violationCard p{margin-bottom:18px}
#violationClose{background:#fff;color:#ff6fa3;border:none;padding:10px 18px;border-radius:12px;cursor:pointer;font-weight:700}
#violationClose:hover{transform:scale(1.05);background:#ffe6f0}

/* Result card (beautiful) */
#resultCard{background:linear-gradient(135deg,#ff6fa3,#ffd9ec);color:#fff;text-align:center;box-shadow:0 12px 60px rgba(0,0,0,.28);border-radius:20px;padding:30px;animation:slideDown .7s ease}
#resultCard h1{font-size:26px;margin-bottom:12px}
#resultCard .result{font-size:22px;font-weight:700;margin-bottom:16px}
.result-actions{display:flex;gap:12px;margin-top:10px;justify-content:center}
.result-actions button{background:#fff;color:#ff6fa3;padding:10px 18px;border:none;border-radius:12px;font-weight:700;cursor:pointer;transition:transform .15s}
.result-actions button:hover{transform:scale(1.06);background:#ffe6f0;color:#ff6fa3}

/* small screens */
@media (max-width:420px){
  #resultCard .result{font-size:18px}
  h1{font-size:20px}
}
</style>
</head>
<body>
<div class="container">

  <!-- Welcome card -->
  <div class="card" id="welcomeCard">
    <h1>🌸 مرحبًا بكِ في عائلة "نعومة نعومتك" 🌸</h1>
    <p class="lead">أدخل اسمك والرمز السري لتبدأ الاختبار. الرمز الحالي هو <strong>نعومة4</strong>.</p>
    <label>الاسم</label>
    <input id="nameInput" type="text" placeholder="اكتب اسمك هنا">
    <label>الرمز</label>
    <input id="codeInput" type="text" placeholder="اكتب الرمز هنا">
    <div style="margin-top:14px;display:flex;gap:10px;align-items:center">
      <button id="startBtn">ابدأ الاختبار</button>
      <div class="muted" style="font-size:13px">ملاحظة: الرمز لا يمكن استخدامه مرتين.</div>
    </div>
    <div id="welcomeMessage"></div>
  </div>

  <!-- Quiz card -->
  <div class="card hidden" id="quizCard">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <strong id="playerName"></strong>
        <div class="muted">الرمز المستخدم: <span id="playerCode"></span></div>
      </div>
      <div class="timer" id="timer">05:00</div>
    </div>
    <hr>
    <div id="questionsArea"></div>
    <div style="display:flex;justify-content:center;margin-top:12px">
      <button id="finishBtn">إنهاء الاختبار</button>
    </div>
  </div>

  <!-- Result card -->
  <div id="resultCard" class="hidden card">
    <h1>✨ نتيجتك ✨</h1>
    <p class="result" id="resultSummary"></p>
    <div class="result-actions">
      <button id="copyBtn">نسخ النتيجة</button>
      <button id="closeBtn">اذهب إلى عائلتك</button>
    </div>
  </div>

  <!-- Violation -->
  <div id="violationCard" class="hidden" role="alertdialog" aria-modal="true">
    <h1>🚫 مخالفة القواعد 🚫</h1>
    <p id="violationMessage">تم الكشف عن مخالفة — لا يمكنك متابعة اللعبة.</p>
    <div style="display:flex;gap:10px;justify-content:center">
      <button id="violationClose">اذهب إلى عائلتك</button>
    </div>
  </div>

</div>

<script>
/* ==== بيانات الأسئلة ==== */
const QUESTIONS = [
  // 3 أحاديث
  {q:'من قال: "لا يؤمن أحدكم حتى يحب لأخيه ما يحب لنفسه"؟',opts:['النبي ﷺ','أبو بكر','عمر','عثمان'],a:0,type:'choice'},
  {q:'ما هو الحديث الذي يبدأ بـ "من لا يشكر الناس لا يشكر الله"؟',opts:['حديث نبوي','حديث صحابي','حديث تابعي','حديث ضعيف'],a:0,type:'choice'},
  {q:'أي الحديث عن فضل الصدقة؟',opts:['من تصدق...','من صام رمضان...','من قرأ القرآن...','من سمع العلم...'],a:0,type:'choice'},

  // 3 علم نفس
  {q:'ما هي قاعدة التأثير النفسي التي تقول "نحن نميل إلى تذكر الأشياء السهلة"؟',opts:['التحيز المعرفي','الذاكرة الانتقائية','الانطباع الأول','التمثيل الذهني'],a:1,type:'choice'},
  {q:'ما هو الشعور الناتج عن مقارنة نفسك بالآخرين؟',opts:['الغيرة','الرضا','الحب','الخوف'],a:0,type:'choice'},
  {q:'أي من هذه الطرق تساعد على تقليل التوتر النفسي؟',opts:['التنفس العميق','الجلوس بدون هدف','تجاهل المشاعر','التفكير السلبي'],a:0,type:'choice'},

  // 3 عن البشرة/العناية
  {q:'ما هي أهم خطوة للعناية بالبشرة يوميًا؟',opts:['تنظيف البشرة','وضع المكياج','عدم النوم','الحمية فقط'],a:0,type:'choice'},
  {q:'أي عنصر يساعد على إشراق البشرة؟',opts:['فيتامين C','الدهون المشبعة','السكريات','الكافيين'],a:0,type:'choice'},
  {q:'ما أفضل وقت لوضع واقي الشمس؟',opts:['قبل التعرض للشمس','بعد التعرض للشمس','وقت النوم','بعد الاستحمام مباشرة'],a:0,type:'choice'},

  // السؤال النصي الأخير — يتطلب كتابة 5 إجابات مفصولة بالفاصلة العربية "،"
  {q:'ما هو الشيء الذي يجعل وجهك يشع بالنور؟ (اكتب الإجابات مفصولة بالفاصلة العربية "،")',
   answer:['نقاء القلب','حب الله','ذكر الله','حب مخلوقاته','الصلاة'],type:'text'}
];

/* ==== عناصر DOM ==== */
const welcomeCard = document.getElementById('welcomeCard');
const quizCard = document.getElementById('quizCard');
const resultCard = document.getElementById('resultCard');
const nameInput = document.getElementById('nameInput');
const codeInput = document.getElementById('codeInput');
const startBtn = document.getElementById('startBtn');
const questionsArea = document.getElementById('questionsArea');
const finishBtn = document.getElementById('finishBtn');
const resultSummary = document.getElementById('resultSummary');
const playerName = document.getElementById('playerName');
const playerCode = document.getElementById('playerCode');
const copyBtn = document.getElementById('copyBtn');
const closeBtn = document.getElementById('closeBtn');
const welcomeMessage = document.getElementById('welcomeMessage');
const violationCard = document.getElementById('violationCard');
const violationMessage = document.getElementById('violationMessage');
const violationClose = document.getElementById('violationClose');
const timerEl = document.getElementById('timer');

/* ==== حالة ووقت ==== */
let timerInterval = null;
let timeLeft = 300; // 5 دقائق

/* ==== localStorage helpers ==== */
function loadAttempts(){
  try{ return JSON.parse(localStorage.getItem('nn_attempts')||'{}'); }
  catch(e){ return {}; }
}
function saveAttempt(code,data){
  const a = loadAttempts();
  a[code] = data;
  localStorage.setItem('nn_attempts', JSON.stringify(a));
}
function hasAttempt(code){
  const a = loadAttempts();
  return a.hasOwnProperty(code);
}
function saveNameCode(name,code){
  localStorage.setItem('nn_name', name);
  localStorage.setItem('nn_code', code);
}

/* ==== منع PrintScreen (محدود في المتصفحات) ==== */
document.addEventListener('keydown', function(e){
  if(e.key === "PrintScreen"){ e.preventDefault(); alert("لا يمكنك أخذ سكرين للعبة!"); }
});

/* ==== إظهار مخالفة وإقفال كل البطاقات ==== */
function showViolation(name = '', msg = "نعتذر، لا يمكنك الدخول للعبة لأنك خالفت قواعد اللعبة ❌"){
  violationMessage.textContent = `${msg}${ name ? ' — ' + name : '' }`;
  violationCard.classList.remove('hidden');
  welcomeCard.classList.add('hidden');
  quizCard.classList.add('hidden');
  resultCard.classList.add('hidden');
  // دفع المستخدم لعدم البقاء هنا — لكن لا نعيد توجيه تلقائياً سوى عند الضغط على الزر
}

/* ==== بدء ===== */
startBtn.onclick = () => {
  const name = nameInput.value.trim();
  const code = codeInput.value.trim();
  if(!name){ alert('يجب إدخال الاسم.'); return; }
  if(!code){ alert('يجب إدخال الرمز.'); return; }
  // منع استخدام نفس الرمز مرتين: إذا موجود مسبقاً => مخالفة
  if(hasAttempt(code)){
    showViolation(name,"تم الكشف عن محاولة دخول برمز مستخدم سابقًا ❌");
    return;
  }
  // سجل الرمز فوراً كـ inprogress لمنع استخدامه من جهة أخرى
  saveAttempt(code, { name, status: 'inprogress', date: new Date().toISOString() });
  saveNameCode(name, code);

  welcomeMessage.style.display = "block";
  welcomeMessage.textContent = `🌷 أهلاً بكِ ${name}! سيتم بدء الاختبار الآن — تذكري: لا يُسمح بإعادة تحميل الصفحة.`;
  setTimeout(()=> beginQuiz(name,code), 1200);
};

/* ==== عندما يبدأ الاختبار ==== */
function beginQuiz(name, code){
  // دفع حالة التاريخ لمنع زر الرجوع
  try{ history.pushState({quizStarted: true}, '', location.href); } catch(e){}
  welcomeCard.classList.add('hidden');
  quizCard.classList.remove('hidden');
  playerName.textContent = name;
  playerCode.textContent = code;
  renderQuestions();
  // ضبط مؤقت
  timeLeft = 300;
  timerEl && (timerEl.textContent = '05:00');
  timerInterval && clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    timeLeft--;
    const min = String(Math.floor(timeLeft/60)).padStart(2,'0');
    const sec = String(timeLeft%60).padStart(2,'0');
    timerEl && (timerEl.textContent = `${min}:${sec}`);
    if(timeLeft <= 0){ finishTest(name, code); }
  }, 1000);
}

/* ==== عرض الأسئلة ==== */
function renderQuestions(){
  questionsArea.innerHTML = '';
  QUESTIONS.forEach((q,i)=>{
    const div = document.createElement('div');
    div.className = 'question';
    div.innerHTML = `<div><strong>سؤال ${i+1}:</strong> ${q.q}</div>`;
    if(q.type === 'choice'){
      const opts = document.createElement('div'); opts.className = 'options';
      q.opts.forEach((o,j)=>{
        const lbl = document.createElement('label'); lbl.className = 'opt';
        lbl.innerHTML = `<input type="radio" name="q${i}" value="${j}"> ${o}`;
        opts.appendChild(lbl);
      });
      div.appendChild(opts);
    } else if(q.type === 'text'){
      const input = document.createElement('input'); input.type = 'text'; input.name = 'q'+i; input.placeholder = 'اكتب إجابتك هنا';
      div.appendChild(input);
      // توضيح لشروط السؤال الأخير
      if(i === QUESTIONS.length - 1){
        const hint = document.createElement('div');
        hint.className = 'muted';
        hint.style.marginTop = '8px';
        hint.textContent = 'مهم: اكتب الإجابات الخمسة مفصولة بالفاصلة العربية "،" بالضبط — مثال: نقاء القلب، حب الله، ذكر الله، حب مخلوقاته، الصلاة';
        div.appendChild(hint);
      }
    }
    questionsArea.appendChild(div);
  });
}

/* ==== إنهاء الاختبار وحساب النقاط ==== */
finishBtn.onclick = ()=> finishTest(playerName.textContent, playerCode.textContent);

function finishTest(name, code){
  clearInterval(timerInterval);
  let score = 0;
  QUESTIONS.forEach((q,i)=>{
    if(q.type === 'choice'){
      const sel = [...document.getElementsByName('q'+i)].find(e=>e.checked);
      if(sel && parseInt(sel.value) === q.a) score += 10;
    } else if(q.type === 'text'){
      const input = document.getElementsByName('q'+i)[0];
      const val = (input && input.value || '').trim();
      // التحقق الصارم: يجب استخدام الفاصلة العربية "،" بين العناصر، ويجب أن تكون الخمسة موجودة (أي ترتيب مقبول)
      const required = q.answer; // قائمة العناصر المطلوبة
      // تقسيم باستخدام الفاصلة العربية — هذا يضمن وجود الفواصل
      const parts = val.split('،').map(s=>s.trim()).filter(Boolean);
      // شرط قبول: بالضبط 5 أجزاء مفصولة بـ "،" ويحتوي كل جزء على أحد الإجابات المطلوبة (مطابقة دقيقة بعد القص)
      let allPresent = false;
      if(parts.length === required.length){
        allPresent = required.every(req => parts.some(p => p === req));
      }
      if(allPresent) score += 10;
      // ملاحظة: إن لم يكن التنسيق مطابقًا (مثل عدم وجود فواصل أو عدد أجزاء مختلف) => لا تُمنح النقاط
    }
  });

  // حفظ النتيجة النهائية وتغيير حالة الكود إلى completed
  saveAttempt(code, { name, score, status: 'completed', date: new Date().toISOString() });

  // إظهار النتيجة بشكل جميل
  quizCard.classList.add('hidden');
  resultCard.classList.remove('hidden');
  resultSummary.innerHTML = `<strong>${name}</strong><br>حصلت على <strong>${score} من ${QUESTIONS.length*10}</strong> نقطة.<br>💖 مبارك لك على إتمام الاختبار!`;

  // لاحظ: بمجرد الانتهاء، يبقى الرمز مستخدماً ولا يمكن إعادة استخدامه (خاصة لأننا حجزناه عند البداية)
}

/* ==== نسخ النتيجة ==== */
copyBtn.onclick = async () => {
  try{
    await navigator.clipboard.writeText(resultSummary.textContent);
    alert('تم نسخ النتيجة!');
  }catch(e){
    alert('انسخ النتيجة يدويًا.');
  }
};

/* ==== أزرار الانتقال ==== */
closeBtn.onclick = () => { window.location.href = 'https://www.facebook.com/profile.php?id=61581366775114'; };
violationClose.onclick = () => { window.location.href = 'https://www.facebook.com/profile.php?id=61581366775114'; };

/* ==== منع الغش: قبل إغلاق/تحديث الصفحة أو الضغط على زر العودة ==== */
// قبلunload: نعرض رسالة ونظهر مخالفة (ستظهر في معظم المتصفحات).
window.addEventListener('beforeunload', function(e){
  // عرض بطاقة مخالفة عند محاولة إعادة التحميل أو الإغلاق
  const storedName = localStorage.getItem('nn_name') || '';
  showViolation(storedName, "تم الكشف عن محاولة غش أو إعادة تحميل الصفحة ❌");
  // محاولة إظهار رسالة منبثقة (مطلوب حسب المتصفح) — هذا يمنع عادة إعادة التحميل.
  e.preventDefault();
  e.returnValue = '';
  return '';
});

// منع استخدام زر الرجوع: نضيف حالة في التاريخ ونتعامل مع popstate
window.addEventListener('popstate', function(event){
  const storedName = localStorage.getItem('nn_name') || '';
  showViolation(storedName, "تم اكتشاف محاولة الرجوع إلى الخلف — تم إيقاف العملية ❌");
});

// أيضاً نمنع history.back عبر زر العودة داخل الصفحة (لوضع حماية إضافية)
function blockBackNavigation(){
  try{ history.pushState(null, document.title, location.href); }catch(e){}
}
blockBackNavigation();

/* ==== عند تحميل الصفحة: منع الدخول المكرر أو اكتشاف جلسة سابقة ==== */
window.addEventListener('load', function(){
  const storedName = localStorage.getItem('nn_name');
  const storedCode = localStorage.getItem('nn_code');
  const attempts = loadAttempts();
  // إذا كان هذا الرمز موجودًا كـ completed أو inprogress => إظهار مخالفة
  if(storedCode && attempts[storedCode]){
    // إذا الحالة inprogress أو completed => منع
    showViolation(storedName, "تم الكشف عن محاولة دخول مكرر أو جلسة نشطة من قبل ❌");
  }
});

/* ==== اختصارات الإدخال (Enter) ==== */
nameInput.addEventListener('keypress', e => { if(e.key === "Enter") startBtn.click(); });
codeInput.addEventListener('keypress', e => { if(e.key === "Enter") startBtn.click(); });

/* ==== ملاحظة تقنية مهمة للمطور: ==== */
/*
  - يتم تسجيل الكود فور الضغط على "ابدأ الاختبار" في localStorage كـ inprogress
    حتى لا يتم استخدامه مرتين (حتى لو لم يكمل المشارك الاختبار).
  - لإعادة استخدام رمز ما طريقياً: يجب حذف المفتاح من localStorage 'nn_attempts'
    أو تحريره يدوياً — وهذا توقع طبيعي للنظام المحلي بدون خادم.
  - التحقق من السؤال الأخير صارم: يجب كتابة العناصر الخمسة مفصولة بالفاصلة العربية "،"
    بالترتيب أيًا كان، ويجب أن تكون كل قطعة مطابقة حرفيًا لأحد العناصر المطلوبة.
*/
</script>
</body>
</html>
