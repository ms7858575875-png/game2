<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>مسابقة - نعومة نعومتك</title>
<style>
:root {
  --bg: #fff0f8;
  --card: #ffffff;
  --accent: #ff6fa3;
  --accent-2: #ffd9ec;
  --text: #2b2b2b;
}
* { box-sizing: border-box; font-family: "Tajawal", sans-serif; }
body { background: linear-gradient(180deg, var(--bg), #fff); min-height: 100vh; margin:0; padding:24px; display:flex; align-items:center; justify-content:center; }
.container { width:100%; max-width:820px; }
.card { background: var(--card); border-radius:18px; padding:22px; box-shadow: 0 8px 30px rgba(0,0,0,0.07); animation: fadeIn 0.7s ease; }
@keyframes fadeIn { from {opacity:0; transform: scale(0.9);} to {opacity:1; transform: scale(1);} }
h1 { margin:6px 0 12px; color: var(--accent); font-size:22px; }
p.lead { margin:0 0 14px; color:var(--text); opacity:0.9; }
label { display:block; margin:10px 0 6px; font-weight:600; color:var(--text); }
input[type=text] { width:100%; padding:12px; border-radius:10px; border:1px solid #eee; background: var(--accent-2); transition: all 0.2s; }
input[type=text]:focus { border-color: var(--accent); background:#fff; outline:none; }
button { background: var(--accent); color:white; padding:10px 14px; border:none; border-radius:10px; font-weight:700; cursor:pointer; transition:0.2s; }
button:hover { transform: scale(1.05); }
.muted { color:#666; font-size:13px; }
.hidden { display:none; }
.question { padding:12px; border-radius:12px; border:1px dashed #f3cde0; margin-bottom:10px; }
.options { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
.opt { padding:10px; border-radius:10px; background:#fff; cursor:pointer; border:1px solid #f2f2f2; }
.opt:hover { background: var(--accent-2); }
.opt input { margin-left:8px; }
.timer { font-weight:800; color:var(--accent); }

#welcomeMessage { background: var(--accent-2); padding:14px; border-radius:12px; margin-top:15px; color: var(--accent); font-weight:600; text-align:center; display:none; animation: slideDown 0.7s ease; }

#violationCard { position: fixed; top:50%; left:50%; transform: translate(-50%, -50%); background: linear-gradient(135deg,#ff6fa3,#ffd9ec); color:#fff; text-align:center; padding:40px 30px; border-radius:25px; box-shadow:0 10px 40px rgba(0,0,0,0.25); font-size:20px; width:90%; max-width:500px; z-index:9999; }
#violationCard h1, #violationCard p { margin-bottom:20px; }
#violationClose { background:#fff;color:#ff6fa3;border:none;padding:10px 20px;border-radius:10px;cursor:pointer;font-weight:700; }
#violationClose:hover { transform: scale(1.1); background:#ffe6f0; }

@keyframes slideDown { from{opacity:0; transform:translateY(-30px);} to{opacity:1; transform:translateY(0);} }

#resultCard {
  background: linear-gradient(135deg,#ff6fa3,#ffd9ec);
  color:white;
  text-align:center;
  box-shadow:0 10px 40px rgba(0,0,0,0.3);
  border-radius:20px;
  padding:30px;
  animation: slideDown 0.7s ease;
}
#resultCard h1 { font-size:26px; margin-bottom:15px; }
#resultCard .result { font-size:22px; font-weight:700; margin-bottom:20px; }
#resultCard button { background:white; color:#ff6fa3; padding:10px 18px; border:none; border-radius:12px; font-weight:700; cursor:pointer; transition:0.3s; }
#resultCard button:hover { transform: scale(1.1); background:#ffe6f0; color:#ff6fa3; }

</style>
</head>
<body>
<div class="container">

<!-- بطاقة الترحيب -->
<div class="card" id="welcomeCard">
  <h1>🌸 مرحبًا بكِ في عائلة "نعومة نعومتك" 🌸</h1>
  <p class="lead">أدخل اسمك والرمز السري لتبدأ الاختبار. الرمز الحالي هو <strong>نعومة4</strong>.</p>
  <label>الاسم</label>
  <input id="nameInput" type="text" placeholder="اكتب اسمك هنا">
  <label>الرمز</label>
  <input id="codeInput" type="text" placeholder="اكتب الرمز هنا">
  <button id="startBtn">ابدأ الاختبار</button>
  <div id="welcomeMessage"></div>
</div>

<!-- بطاقة الاختبار -->
<div class="card hidden" id="quizCard">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div>
      <strong id="playerName"></strong>
      <div class="muted">الرمز المستخدم: <span id="playerCode"></span></div>
    </div>
    <div class="timer" id="timer">05:00</div>
  </div>
  <hr>
  <div id="questionsArea"></div>
  <button id="finishBtn">إنهاء الاختبار</button>
</div>

<!-- بطاقة النتيجة -->
<div class="card hidden" id="resultCard">
  <h1>✨ نتيجتك ✨</h1>
  <p class="result" id="resultSummary"></p>
  <div style="display:flex;gap:10px;margin-top:10px; justify-content:center;">
    <button id="copyBtn">نسخ النتيجة</button>
    <button id="closeBtn">اذهب إلى عائلتك</button>
  </div>
</div>

<!-- بطاقة مخالفة القواعد -->
<div id="violationCard" class="hidden">
  <h1>🚫 مخالفة القواعد 🚫</h1>
  <p id="violationMessage"></p>
  <button id="violationClose">اذهب إلى عائلتك</button>
</div>

<script>
const QUESTIONS = [
  {q:'من قال: "لا يؤمن أحدكم حتى يحب لأخيه ما يحب لنفسه"؟',opts:['النبي ﷺ','أبو بكر','عمر','عثمان'],a:0,type:'choice'},
  {q:'ما هو الحديث الذي يبدأ بـ "من لا يشكر الناس لا يشكر الله"؟',opts:['حديث نبوي','حديث صحابي','حديث تابعي','حديث ضعيف'],a:0,type:'choice'},
  {q:'أي الحديث عن فضل الصدقة؟',opts:['من تصدق...','من صام رمضان...','من قرأ القرآن...','من سمع العلم...'],a:0,type:'choice'},
  {q:'ما هي قاعدة التأثير النفسي التي تقول "نحن نميل إلى تذكر الأشياء السهلة"؟',opts:['التحيز المعرفي','الذاكرة الانتقائية','الانطباع الأول','التمثيل الذهني'],a:1,type:'choice'},
  {q:'ما هو الشعور الناتج عن مقارنة نفسك بالآخرين؟',opts:['الغيرة','الرضا','الحب','الخوف'],a:0,type:'choice'},
  {q:'أي من هذه الطرق تساعد على تقليل التوتر النفسي؟',opts:['التنفس العميق','الجلوس بدون هدف','تجاهل المشاعر','التفكير السلبي'],a:0,type:'choice'},
  {q:'ما هي أهم خطوة للعناية بالبشرة يوميًا؟',opts:['تنظيف البشرة','وضع المكياج','عدم النوم','الحمية فقط'],a:0,type:'choice'},
  {q:'أي عنصر يساعد على إشراق البشرة؟',opts:['فيتامين C','الدهون المشبعة','السكريات','الكافيين'],a:0,type:'choice'},
  {q:'ما أفضل وقت لوضع واقي الشمس؟',opts:['قبل التعرض للشمس','بعد التعرض للشمس','وقت النوم','بعد الاستحمام مباشرة'],a:0,type:'choice'},
  {q:'ما هو الشيء الذي يجعل وجهك يشع بالنور؟',answer:['نقاء القلب','حب الله','ذكر الله','حب مخلوقاته','الصلاة'],type:'text'}
];

const welcomeCard=document.getElementById('welcomeCard');
const quizCard=document.getElementById('quizCard');
const resultCard=document.getElementById('resultCard');
const nameInput=document.getElementById('nameInput');
const codeInput=document.getElementById('codeInput');
const startBtn=document.getElementById('startBtn');
const questionsArea=document.getElementById('questionsArea');
const finishBtn=document.getElementById('finishBtn');
const resultSummary=document.getElementById('resultSummary');
const playerName=document.getElementById('playerName');
const playerCode=document.getElementById('playerCode');
const copyBtn=document.getElementById('copyBtn');
const closeBtn=document.getElementById('closeBtn');
const welcomeMessage=document.getElementById('welcomeMessage');
const violationCard=document.getElementById('violationCard');
const violationMessage=document.getElementById('violationMessage');
const violationClose=document.getElementById('violationClose');

let timerInterval,timeLeft=300;

function loadAttempts(){try{return JSON.parse(localStorage.getItem('nn_attempts')||'{}');}catch(e){return {}}}
function saveAttempt(code,data){const a=loadAttempts();a[code]=data;localStorage.setItem('nn_attempts',JSON.stringify(a));}
function hasAttempt(code){return loadAttempts().hasOwnProperty(code);}
function saveNameCode(name,code){localStorage.setItem('nn_name',name); localStorage.setItem('nn_code',code);}

document.addEventListener('keydown',function(e){if(e.key==="PrintScreen"){e.preventDefault(); alert("لا يمكنك أخذ سكرين للعبة!");}});

function showViolation(name,message){
  violationMessage.textContent = message;
  violationCard.classList.remove('hidden');
}

startBtn.onclick = () => {
  const name = nameInput.value.trim();
  const code = codeInput.value.trim();
  if (!name) { alert('يجب إدخال الاسم.'); return; }
  if (code !== 'نعومة4') { alert('الرمز غير صحيح ❌'); return; }

  if (hasAttempt(code)) {
    showViolation(name, `🚫 عذرًا ${name}، لقد استخدمت هذا الرمز مسبقًا ❌ لا يمكنك استخدامه مرة ثانية.`);
    return;
  }

  welcomeMessage.style.display = "block";
  welcomeMessage.textContent = `🌷 أهلاً بكِ ${name}! سررنا بانضمامك إلى عائلة نعومة نعومتك 💖`;
  saveNameCode(name, code);

  setTimeout(() => { beginQuiz(name, code); }, 2000);
};

function beginQuiz(name,code){
  welcomeCard.classList.add('hidden');
  quizCard.classList.remove('hidden');
  playerName.textContent=name;
  playerCode.textContent=code;
  renderQuestions();
  timeLeft=300;
  document.getElementById('timer').textContent='05:00';
  timerInterval=setInterval(()=>{
    timeLeft--;
    const min=String(Math.floor(timeLeft/60)).padStart(2,'0');
    const sec=String(timeLeft%60).padStart(2,'0');
    document.getElementById('timer').textContent=`${min}:${sec}`;
    if(timeLeft<=0){finishTest(name,code);}
  },1000);
}

function renderQuestions(){
  questionsArea.innerHTML='';
  QUESTIONS.forEach((q,i)=>{
    const div=document.createElement('div'); div.className='question';
    div.innerHTML=`<div><strong>سؤال ${i+1}:</strong> ${q.q}</div>`;
    if(q.type==='choice'){
      const opts=document.createElement('div'); opts.className='options';
      q.opts.forEach((o,j)=>{
        const lbl=document.createElement('label'); lbl.className='opt';
        lbl.innerHTML=`<input type='radio' name='q${i}' value='${j}'> ${o}`;
        opts.appendChild(lbl);
      });
      div.appendChild(opts);
    }else if(q.type==='text'){
      const input=document.createElement('input'); input.type='text'; input.name='q'+i; input.placeholder='اكتب إجابتك هنا';
      div.appendChild(input);
    }
    questionsArea.appendChild(div);
  });
}

finishBtn.onclick=()=>{finishTest(playerName.textContent,playerCode.textContent);};

function finishTest(name,code){
  clearInterval(timerInterval);
  let score=0;
  QUESTIONS.forEach((q,i)=>{
    if(q.type==='choice'){
      const sel=[...document.getElementsByName('q'+i)].find(e=>e.checked);
      if(sel && parseInt(sel.value)===q.a) score+=10;
    } else if(q.type==='text'){
      const val=document.getElementsByName('q'+i)[0].value.trim();
      let matches=0;
      q.answer.forEach(ans=>{ if(val.includes(ans)) matches++; });
      if(matches===q.answer.length) score+=10;
    }
  });

  quizCard.classList.add('hidden'); resultCard.classList.remove('hidden');

  resultSummary.innerHTML=`<strong>${name}</strong><br>حصلت على <strong>${score} من ${QUESTIONS.length*10}</strong> نقطة.<br>💖 مبارك لك على إتمام الاختبار!`;

  saveAttempt(code,{name,score,date:new Date().toISOString()});
}

copyBtn.onclick=async()=>{
  try{ await navigator.clipboard.writeText(resultSummary.textContent); alert('تم نسخ النتيجة!'); }
  catch(e){ alert('انسخ النتيجة يدويًا.'); }
};

closeBtn.onclick = () => { window.location.href='https://www.facebook.com/profile.php?id=61581366775114'; };
violationClose.onclick=()=>{ window.location.href='https://www.facebook.com/profile.php?id=61581366775114'; };

window.addEventListener('load',()=>{
  const storedName=localStorage.getItem('nn_name');
  const storedCode=localStorage.getItem('nn_code');
  const attempts=loadAttempts();
  if(storedName && storedCode && attempts[storedCode]){
    welcomeCard.classList.add('hidden');
    quizCard.classList.add('hidden');
    resultCard.classList.add('hidden');
    showViolation(storedName, `🚫 عذرًا ${storedName}، لقد استخدمت هذا الرمز مسبقًا ❌ لا يمكنك استخدامه مرة ثانية.`);
  }
});

nameInput.addEventListener("keypress", e => {if(e.key==="Enter") startBtn.click();});
codeInput.addEventListener("keypress", e => {if(e.key==="Enter") startBtn.click();});
</script>
</body>
</html>
